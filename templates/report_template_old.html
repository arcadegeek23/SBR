<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Strategic Business Review - {{ customer_name }}</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f5f5;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 60px 40px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .header .subtitle {
            font-size: 1.5em;
            opacity: 0.9;
        }
        
        .header .meta {
            margin-top: 20px;
            font-size: 0.95em;
            opacity: 0.8;
        }
        
        .content {
            padding: 40px;
        }
        
        .section {
            margin-bottom: 40px;
        }
        
        .section h2 {
            color: #667eea;
            font-size: 1.8em;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
        }
        
        .section h3 {
            color: #764ba2;
            font-size: 1.3em;
            margin: 20px 0 10px 0;
        }
        
        .score-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            margin: 20px 0;
        }
        
        .score-card .score {
            font-size: 4em;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .score-card .label {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        table th {
            background: #667eea;
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }
        
        table td {
            padding: 12px 15px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        table tr:hover {
            background: #f9f9f9;
        }
        
        .status-good {
            color: #10b981;
            font-weight: bold;
        }
        
        .status-warning {
            color: #f59e0b;
            font-weight: bold;
        }
        
        .status-critical {
            color: #ef4444;
            font-weight: bold;
        }
        
        .gap-card {
            background: #fff;
            border-left: 4px solid #ef4444;
            padding: 20px;
            margin: 15px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border-radius: 5px;
        }
        
        .gap-card.severity-high {
            border-left-color: #f59e0b;
        }
        
        .gap-card.severity-medium {
            border-left-color: #3b82f6;
        }
        
        .gap-card .gap-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .gap-card .gap-title {
            font-size: 1.2em;
            font-weight: 600;
            color: #333;
        }
        
        .gap-card .severity-badge {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: bold;
            color: white;
        }
        
        .severity-badge.critical {
            background: #ef4444;
        }
        
        .severity-badge.high {
            background: #f59e0b;
        }
        
        .severity-badge.medium {
            background: #3b82f6;
        }
        
        .rec-card {
            background: #f0f9ff;
            border-left: 4px solid #3b82f6;
            padding: 20px;
            margin: 15px 0;
            border-radius: 5px;
        }
        
        .rec-card ul {
            margin: 10px 0 0 20px;
        }
        
        .rec-card li {
            margin: 5px 0;
        }
        
        .budget-summary {
            background: #ecfdf5;
            border: 2px solid #10b981;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .budget-total {
            font-size: 1.5em;
            font-weight: bold;
            color: #10b981;
            text-align: center;
            margin-top: 15px;
        }
        
        .metric-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .metric-box {
            background: white;
            border: 2px solid #e5e7eb;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }
        
        .metric-box .value {
            font-size: 2.5em;
            font-weight: bold;
            color: #667eea;
            margin: 10px 0;
        }
        
        .metric-box .label {
            color: #6b7280;
            font-size: 0.95em;
        }
        
        .footer {
            background: #f9fafb;
            padding: 30px 40px;
            text-align: center;
            color: #6b7280;
            border-top: 1px solid #e5e7eb;
        }
        
        @media print {
            body {
                background: white;
            }
            .container {
                box-shadow: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Strategic Business Review</h1>
            <div class="subtitle">{{ customer_name }}</div>
            <div class="meta">
                Report Generated: {{ generated_at }}<br>
                Review Period: {{ review_period }}
            </div>
        </div>
        
        <div class="content">
            <!-- Executive Summary -->
            <div class="section">
                <h2>Executive Summary</h2>
                <p>This Strategic Business Review provides a comprehensive assessment of {{ customer_name }}'s current IT security and operational posture, aligned to the <strong>NIST Cybersecurity Framework (CSF)</strong>.</p>
                
                <div class="score-card">
                    <div class="label">Overall Security Posture Score</div>
                    <div class="score">{{ "%.1f" | format(overall_score * 100) }}%</div>
                    <div class="label">
                        {% if overall_score >= 0.9 %}
                        Excellent - Strong security posture with minimal gaps
                        {% elif overall_score >= 0.75 %}
                        Good - Solid foundation with some areas for improvement
                        {% elif overall_score >= 0.60 %}
                        Fair - Moderate gaps requiring attention
                        {% else %}
                        Needs Improvement - Significant security gaps identified
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <!-- NIST Scores -->
            <div class="section">
                <h2>NIST Cybersecurity Framework Scores</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Category</th>
                            <th>Score</th>
                            <th>Status</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Identify</strong></td>
                            <td>{{ "%.1f" | format(nist_scores.Identify * 100) }}%</td>
                            <td class="{% if nist_scores.Identify >= 0.9 %}status-good{% elif nist_scores.Identify >= 0.75 %}status-warning{% else %}status-critical{% endif %}">
                                {% if nist_scores.Identify >= 0.9 %}✓ Strong{% elif nist_scores.Identify >= 0.75 %}→ Good{% else %}⚠ Needs Work{% endif %}
                            </td>
                            <td>Asset visibility and inventory management</td>
                        </tr>
                        <tr>
                            <td><strong>Protect</strong></td>
                            <td>{{ "%.1f" | format(nist_scores.Protect * 100) }}%</td>
                            <td class="{% if nist_scores.Protect >= 0.9 %}status-good{% elif nist_scores.Protect >= 0.75 %}status-warning{% else %}status-critical{% endif %}">
                                {% if nist_scores.Protect >= 0.9 %}✓ Strong{% elif nist_scores.Protect >= 0.75 %}→ Good{% else %}⚠ Needs Work{% endif %}
                            </td>
                            <td>Preventive security controls</td>
                        </tr>
                        <tr>
                            <td><strong>Detect</strong></td>
                            <td>{{ "%.1f" | format(nist_scores.Detect * 100) }}%</td>
                            <td class="{% if nist_scores.Detect >= 0.9 %}status-good{% elif nist_scores.Detect >= 0.75 %}status-warning{% else %}status-critical{% endif %}">
                                {% if nist_scores.Detect >= 0.9 %}✓ Strong{% elif nist_scores.Detect >= 0.75 %}→ Good{% else %}⚠ Needs Work{% endif %}
                            </td>
                            <td>Threat detection and monitoring</td>
                        </tr>
                        <tr>
                            <td><strong>Respond</strong></td>
                            <td>{{ "%.1f" | format(nist_scores.Respond * 100) }}%</td>
                            <td class="{% if nist_scores.Respond >= 0.9 %}status-good{% elif nist_scores.Respond >= 0.75 %}status-warning{% else %}status-critical{% endif %}">
                                {% if nist_scores.Respond >= 0.9 %}✓ Strong{% elif nist_scores.Respond >= 0.75 %}→ Good{% else %}⚠ Needs Work{% endif %}
                            </td>
                            <td>Incident response and SLA performance</td>
                        </tr>
                        <tr>
                            <td><strong>Recover</strong></td>
                            <td>{{ "%.1f" | format(nist_scores.Recover * 100) }}%</td>
                            <td class="{% if nist_scores.Recover >= 0.9 %}status-good{% elif nist_scores.Recover >= 0.75 %}status-warning{% else %}status-critical{% endif %}">
                                {% if nist_scores.Recover >= 0.9 %}✓ Strong{% elif nist_scores.Recover >= 0.75 %}→ Good{% else %}⚠ Needs Work{% endif %}
                            </td>
                            <td>Business continuity and backup</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <!-- Key Metrics -->
            <div class="section">
                <h2>Key Operational Metrics</h2>
                <div class="metric-grid">
                    <div class="metric-box">
                        <div class="label">Total Assets</div>
                        <div class="value">{{ signals.total_assets }}</div>
                    </div>
                    <div class="metric-box">
                        <div class="label">Active Users</div>
                        <div class="value">{{ signals.total_users }}</div>
                    </div>
                    <div class="metric-box">
                        <div class="label">Servers</div>
                        <div class="value">{{ signals.total_servers }}</div>
                    </div>
                    <div class="metric-box">
                        <div class="label">Endpoints</div>
                        <div class="value">{{ signals.total_endpoints }}</div>
                    </div>
                </div>
                
                <table>
                    <thead>
                        <tr>
                            <th>Metric</th>
                            <th>Current Value</th>
                            <th>Target</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Patch Compliance</td>
                            <td>{{ "%.1f" | format(signals.patch_compliance) }}%</td>
                            <td>≥ 95%</td>
                            <td class="{% if signals.patch_compliance >= 95 %}status-good{% else %}status-critical{% endif %}">
                                {% if signals.patch_compliance >= 95 %}✓ Meeting Target{% else %}⚠ Below Target{% endif %}
                            </td>
                        </tr>
                        <tr>
                            <td>Backup Coverage</td>
                            <td>{{ "%.1f" | format(signals.backup_status) }}%</td>
                            <td>≥ 98%</td>
                            <td class="{% if signals.backup_status >= 98 %}status-good{% else %}status-critical{% endif %}">
                                {% if signals.backup_status >= 98 %}✓ Meeting Target{% else %}⚠ Below Target{% endif %}
                            </td>
                        </tr>
                        <tr>
                            <td>EDR Coverage</td>
                            <td>{{ "%.1f" | format(signals.edr) }}%</td>
                            <td>≥ 90%</td>
                            <td class="{% if signals.edr >= 90 %}status-good{% else %}status-critical{% endif %}">
                                {% if signals.edr >= 90 %}✓ Meeting Target{% else %}⚠ Below Target{% endif %}
                            </td>
                        </tr>
                        <tr>
                            <td>SLA Attainment</td>
                            <td>{{ "%.1f" | format(signals.response_time_sla) }}%</td>
                            <td>≥ 90%</td>
                            <td class="{% if signals.response_time_sla >= 90 %}status-good{% else %}status-warning{% endif %}">
                                {% if signals.response_time_sla >= 90 %}✓ Meeting Target{% else %}⚠ Below Target{% endif %}
                            </td>
                        </tr>
                        <tr>
                            <td>MFA Enforcement</td>
                            <td>{% if signals.mfa >= 100 %}Enabled{% else %}Not Enabled{% endif %}</td>
                            <td>Enabled</td>
                            <td class="{% if signals.mfa >= 100 %}status-good{% else %}status-critical{% endif %}">
                                {% if signals.mfa >= 100 %}✓ Enabled{% else %}⚠ Not Enabled{% endif %}
                            </td>
                        </tr>
                        <tr>
                            <td>Avg. Monthly Incidents</td>
                            <td>{{ "%.0f" | format(signals.incident_volume) }}</td>
                            <td>-</td>
                            <td>-</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <!-- Gaps -->
            <div class="section">
                <h2>Identified Gaps and Risks</h2>
                {% if gaps %}
                    {% for gap in gaps %}
                    <div class="gap-card severity-{{ gap.severity|lower }}">
                        <div class="gap-header">
                            <div class="gap-title">{{ gap.issue }}</div>
                            <div class="severity-badge {{ gap.severity|lower }}">{{ gap.severity }}</div>
                        </div>
                        <p><strong>Category:</strong> {{ gap.category }}</p>
                        <p><strong>Current Value:</strong> {{ "%.1f" | format(gap.current_value) }}% | <strong>Threshold:</strong> {{ gap.threshold }}%</p>
                        <p><strong>Impact:</strong> {{ gap.impact }}</p>
                    </div>
                    {% endfor %}
                {% else %}
                    <p style="color: #10b981; font-weight: bold;">✓ No significant gaps identified. Current posture meets or exceeds best practice thresholds.</p>
                {% endif %}
            </div>
            
            <!-- Recommendations -->
            <div class="section">
                <h2>Recommendations</h2>
                {% if recommendations %}
                    {% for rec in recommendations %}
                    <div class="rec-card">
                        <h3>{{ loop.index }}. {{ rec.recommendation }}</h3>
                        <p><strong>Priority:</strong> {{ rec.priority }} | <strong>NIST Category:</strong> {{ rec.category }}</p>
                        <p><strong>Action Items:</strong></p>
                        <ul>
                            {% for action in rec.action_items %}
                            <li>{{ action }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                    {% endfor %}
                {% else %}
                    <p style="color: #10b981; font-weight: bold;">✓ No immediate recommendations. Continue monitoring and maintaining current security posture.</p>
                {% endif %}
            </div>
            
            <!-- Budget -->
            <div class="section">
                <h2>Budget Projection</h2>
                {% if budget.services %}
                    <p>The following monthly budget estimates address the identified gaps:</p>
                    <table>
                        <thead>
                            <tr>
                                <th>Service</th>
                                <th>Quantity</th>
                                <th>Unit Cost</th>
                                <th>Monthly Cost</th>
                                <th>Annual Cost</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for service in budget.services %}
                            <tr>
                                <td>{{ service.service }}</td>
                                <td>{{ service.quantity }} {{ service.unit }}</td>
                                <td>${{ "%.2f" | format(service.unit_cost) }}</td>
                                <td>${{ "%.2f" | format(service.monthly_cost) }}</td>
                                <td>${{ "%.2f" | format(service.annual_cost) }}</td>
                            </tr>
                            {% endfor %}
                            <tr style="background: #f0f9ff; font-weight: bold;">
                                <td colspan="3">TOTAL</td>
                                <td>${{ "%.2f" | format(budget.total_monthly) }}</td>
                                <td>${{ "%.2f" | format(budget.total_annual) }}</td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <div class="budget-summary">
                        <h3>Investment Justification</h3>
                        <p>Implementing these recommendations will:</p>
                        <ul>
                            <li>Reduce security risk exposure by addressing critical gaps</li>
                            <li>Improve operational efficiency and incident response times</li>
                            <li>Ensure compliance with industry best practices and frameworks</li>
                            <li>Provide measurable ROI through reduced breach risk and downtime</li>
                        </ul>
                        <div class="budget-total">
                            Total Investment: ${{ "%.2f" | format(budget.total_monthly) }}/month
                        </div>
                    </div>
                {% else %}
                    <p style="color: #10b981; font-weight: bold;">✓ No additional budget required at this time. Current investments are adequate for the identified posture.</p>
                {% endif %}
            </div>
            
            <!-- Next Steps -->
            <div class="section">
                <h2>Next Steps</h2>
                <ol>
                    <li><strong>Review and Validate:</strong> Confirm accuracy of data and identified gaps with technical team</li>
                    <li><strong>Prioritize Actions:</strong> Align recommendations with business objectives and budget cycles</li>
                    <li><strong>Create Implementation Plan:</strong> Develop timeline and resource allocation for priority items</li>
                    <li><strong>Schedule Follow-up:</strong> Plan quarterly review to measure progress and adjust strategy</li>
                    <li><strong>Customer Communication:</strong> Present findings and recommendations in executive briefing</li>
                </ol>
            </div>
        </div>
        
        <div class="footer">
            <p><strong>Report prepared by Computer Integration Technologies</strong></p>
            <p>Automated Strategic Business Review Generator</p>
            <p style="margin-top: 10px; font-size: 0.9em;">Data extracted from HaloPSA | NIST CSF v1.1 Methodology</p>
        </div>
    </div>
</body>
</html>

