<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Strategic Business Review - {{ customer_name }}</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f5f5;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 60px 40px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .header .subtitle {
            font-size: 1.5em;
            opacity: 0.9;
        }
        
        .header .meta {
            margin-top: 20px;
            font-size: 0.95em;
            opacity: 0.8;
        }
        
        .content {
            padding: 40px;
        }
        
        .section {
            margin-bottom: 40px;
        }
        
        .section h2 {
            color: #667eea;
            font-size: 1.8em;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
        }
        
        .section h3 {
            color: #764ba2;
            font-size: 1.3em;
            margin: 20px 0 10px 0;
        }
        
        .score-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            margin: 20px 0;
        }
        
        .score-card .score {
            font-size: 4em;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .score-card .label {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .health-card {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 25px;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .health-card.warning {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        }
        
        .health-card.critical {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        table th {
            background: #667eea;
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }
        
        table td {
            padding: 12px 15px;
            border-bottom: 1px solid #e5e7eb;
        }
        
        table tr:hover {
            background: #f9fafb;
        }
        
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: 600;
        }
        
        .status-strong {
            background: #d1fae5;
            color: #065f46;
        }
        
        .status-good {
            background: #dbeafe;
            color: #1e40af;
        }
        
        .status-needs-work {
            background: #fed7aa;
            color: #92400e;
        }
        
        .gap-card {
            border-left: 5px solid #ef4444;
            background: #fef2f2;
            padding: 20px;
            margin: 15px 0;
            border-radius: 5px;
        }
        
        .gap-card.high {
            border-left-color: #f59e0b;
            background: #fffbeb;
        }
        
        .gap-card.medium {
            border-left-color: #3b82f6;
            background: #eff6ff;
        }
        
        .gap-card h3 {
            margin-top: 0;
        }
        
        .severity-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: 600;
            float: right;
        }
        
        .severity-critical {
            background: #ef4444;
            color: white;
        }
        
        .severity-high {
            background: #f59e0b;
            color: white;
        }
        
        .severity-medium {
            background: #3b82f6;
            color: white;
        }
        
        .rec-card {
            background: #f0f9ff;
            border-left: 5px solid #667eea;
            padding: 20px;
            margin: 15px 0;
            border-radius: 5px;
        }
        
        .rec-card h3 {
            color: #667eea;
            margin-top: 0;
        }
        
        .rec-card ul {
            margin: 10px 0 10px 20px;
        }
        
        .budget-summary {
            background: #f0fdf4;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .budget-total {
            font-size: 1.5em;
            font-weight: bold;
            color: #10b981;
            text-align: center;
            margin-top: 15px;
        }
        
        .metric-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .metric-box {
            background: white;
            border: 2px solid #e5e7eb;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }
        
        .metric-box .value {
            font-size: 2.5em;
            font-weight: bold;
            color: #667eea;
            margin: 10px 0;
        }
        
        .metric-box .label {
            color: #6b7280;
            font-size: 0.95em;
        }
        
        .insight-box {
            background: #fffbeb;
            border-left: 4px solid #f59e0b;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }
        
        .insight-box.positive {
            background: #f0fdf4;
            border-left-color: #10b981;
        }
        
        .insight-box.warning {
            background: #fef2f2;
            border-left-color: #ef4444;
        }
        
        .user-list, .asset-list {
            margin: 15px 0;
        }
        
        .user-item, .asset-item {
            background: white;
            border: 1px solid #e5e7eb;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .user-item:hover, .asset-item:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .chart-container {
            margin: 20px 0;
            padding: 20px;
            background: #f9fafb;
            border-radius: 8px;
        }
        
        .footer {
            background: #f9fafb;
            padding: 30px 40px;
            text-align: center;
            color: #6b7280;
            border-top: 1px solid #e5e7eb;
        }
        
        @media print {
            body {
                background: white;
            }
            .container {
                box-shadow: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Strategic Business Review</h1>
            <div class="subtitle">{{ customer_name }}</div>
            <div class="meta">
                Report Generated: {{ generated_at }}<br>
                Review Period: {{ review_period }}
            </div>
        </div>
        
        <div class="content">
            <!-- Executive Summary -->
            <div class="section">
                <h2>Executive Summary</h2>
                <p>This Strategic Business Review provides a comprehensive assessment of {{ customer_name }}'s current IT security and operational posture, aligned to the <strong>NIST Cybersecurity Framework (CSF)</strong>.</p>
                
                <div class="score-card">
                    <div class="label">Overall Security Posture Score</div>
                    <div class="score">{{ "%.1f" | format(overall_score * 100) }}%</div>
                    <div class="label">
                        {% if overall_score >= 0.9 %}
                        Excellent - Strong security posture with minimal gaps
                        {% elif overall_score >= 0.75 %}
                        Good - Solid foundation with some areas for improvement
                        {% elif overall_score >= 0.60 %}
                        Fair - Moderate gaps requiring attention
                        {% else %}
                        Needs Improvement - Significant security gaps identified
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <!-- AI Operational Overview -->
            {% if ai_insights.operational_overview %}
            <div class="section">
                <h2>ü§ñ AI Operational Overview</h2>
                <div class="health-card {% if ai_insights.operational_overview.health_color == 'orange' %}warning{% elif ai_insights.operational_overview.health_color == 'red' %}critical{% endif %}">
                    <h3 style="margin-top: 0; font-size: 1.5em;">Operational Health: {{ ai_insights.operational_overview.health_status }}</h3>
                    <div style="font-size: 3em; font-weight: bold; margin: 15px 0;">{{ "%.1f" | format(ai_insights.operational_overview.operational_health_score) }}%</div>
                </div>
                
                <h3>Key Findings</h3>
                <ul style="margin-left: 20px;">
                    {% for point in ai_insights.operational_overview.summary_points %}
                    <li style="margin: 10px 0;">{{ point }}</li>
                    {% endfor %}
                </ul>
                
                <div class="metric-grid">
                    <div class="metric-box">
                        <div class="label">Patch Health</div>
                        <div class="value">{{ "%.0f" | format(ai_insights.operational_overview.key_metrics.patch_health) }}%</div>
                    </div>
                    <div class="metric-box">
                        <div class="label">Backup Health</div>
                        <div class="value">{{ "%.0f" | format(ai_insights.operational_overview.key_metrics.backup_health) }}%</div>
                    </div>
                    <div class="metric-box">
                        <div class="label">SLA Health</div>
                        <div class="value">{{ "%.0f" | format(ai_insights.operational_overview.key_metrics.sla_health) }}%</div>
                    </div>
                    <div class="metric-box">
                        <div class="label">Ticket Health</div>
                        <div class="value">{{ "%.0f" | format(ai_insights.operational_overview.key_metrics.ticket_health) }}%</div>
                    </div>
                </div>
            </div>
            {% endif %}
            
            <!-- Ticket Analysis -->
            {% if ai_insights.ticket_analysis %}
            <div class="section">
                <h2>üìä Ticket Analysis</h2>
                <p><strong>Total Tickets (90 days):</strong> {{ ai_insights.ticket_analysis.total_tickets }}</p>
                <p><strong>Average Resolution Time:</strong> {{ "%.1f" | format(ai_insights.ticket_analysis.avg_resolution_hours) }} hours</p>
                
                <h3>Ticket Categories</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Category</th>
                            <th>Count</th>
                            <th>Percentage</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for category, count in ai_insights.ticket_analysis.categories.items() %}
                        <tr>
                            <td>{{ category }}</td>
                            <td>{{ count }}</td>
                            <td>{{ "%.1f" | format(count / ai_insights.ticket_analysis.total_tickets * 100) }}%</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                
                <h3>Priority Distribution</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Priority</th>
                            <th>Count</th>
                            <th>Percentage</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for priority, count in ai_insights.ticket_analysis.priorities.items() %}
                        <tr>
                            <td>{{ priority }}</td>
                            <td>{{ count }}</td>
                            <td>{{ "%.1f" | format(count / ai_insights.ticket_analysis.total_tickets * 100) }}%</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                
                <h3>Insights</h3>
                {% for insight in ai_insights.ticket_analysis.insights %}
                <div class="insight-box">{{ insight }}</div>
                {% endfor %}
            </div>
            {% endif %}
            
            <!-- SLA Performance -->
            {% if ai_insights.sla_performance %}
            <div class="section">
                <h2>‚è±Ô∏è SLA Performance Analysis</h2>
                <p><strong>Overall SLA Attainment:</strong> {{ "%.1f" | format(ai_insights.sla_performance.overall_attainment) }}%</p>
                <p><strong>Total SLA Breaches:</strong> {{ ai_insights.sla_performance.total_breaches }}</p>
                
                <h3>Performance by Priority</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Priority</th>
                            <th>SLA Attainment</th>
                            <th>Met</th>
                            <th>Breached</th>
                            <th>Total</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for priority, stats in ai_insights.sla_performance.by_priority.items() %}
                        <tr>
                            <td>{{ priority }}</td>
                            <td>
                                <span class="status-badge {% if stats.attainment >= 90 %}status-strong{% elif stats.attainment >= 75 %}status-good{% else %}status-needs-work{% endif %}">
                                    {{ "%.1f" | format(stats.attainment) }}%
                                </span>
                            </td>
                            <td>{{ stats.met }}</td>
                            <td>{{ stats.breached }}</td>
                            <td>{{ stats.total }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                
                <h3>Worst Performing Categories</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Category</th>
                            <th>SLA Attainment</th>
                            <th>Total Tickets</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for category, stats in ai_insights.sla_performance.by_category.items() %}
                        <tr>
                            <td>{{ category }}</td>
                            <td>{{ "%.1f" | format(stats.attainment) }}%</td>
                            <td>{{ stats.total }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                
                <h3>Insights</h3>
                {% for insight in ai_insights.sla_performance.insights %}
                <div class="insight-box warning">{{ insight }}</div>
                {% endfor %}
            </div>
            {% endif %}
            
            <!-- Top Users -->
            {% if ai_insights.top_users and ai_insights.top_users.top_users %}
            <div class="section">
                <h2>üë• Top Users by Ticket Volume</h2>
                <p>Users generating the most support tickets:</p>
                
                <table>
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>User</th>
                            <th>Tickets</th>
                            <th>% of Total</th>
                            <th>Top Category</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for user in ai_insights.top_users.top_users %}
                        <tr>
                            <td>{{ loop.index }}</td>
                            <td>{{ user.user }}</td>
                            <td>{{ user.ticket_count }}</td>
                            <td>{{ "%.1f" | format(user.percentage) }}%</td>
                            <td>{{ user.top_category }} ({{ user.category_count }})</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                
                <h3>Insights</h3>
                {% for insight in ai_insights.top_users.insights %}
                <div class="insight-box">{{ insight }}</div>
                {% endfor %}
            </div>
            {% endif %}
            
            <!-- Top Assets -->
            {% if ai_insights.top_assets and ai_insights.top_assets.top_assets %}
            <div class="section">
                <h2>üíª Top Assets Requiring Attention</h2>
                <p>Assets generating the most support tickets:</p>
                
                <table>
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>Asset</th>
                            <th>Type</th>
                            <th>Tickets</th>
                            <th>% of Total</th>
                            <th>Top Issue</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for asset in ai_insights.top_assets.top_assets %}
                        <tr>
                            <td>{{ loop.index }}</td>
                            <td>{{ asset.asset }}</td>
                            <td>{{ asset.asset_type }}</td>
                            <td>{{ asset.ticket_count }}</td>
                            <td>{{ "%.1f" | format(asset.percentage) }}%</td>
                            <td>{{ asset.top_issue }} ({{ asset.issue_count }})</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                
                <h3>Insights</h3>
                {% for insight in ai_insights.top_assets.insights %}
                <div class="insight-box warning">{{ insight }}</div>
                {% endfor %}
            </div>
            {% endif %}
            
            <!-- AI Recommendations -->
            {% if ai_insights.ai_recommendations %}
            <div class="section">
                <h2>üéØ AI-Powered Recommendations</h2>
                <p>Data-driven recommendations based on ticket patterns and operational metrics:</p>
                
                {% for rec in ai_insights.ai_recommendations %}
                <div class="rec-card">
                    <h3>{{ rec.title }}</h3>
                    <p><strong>Priority:</strong> {{ rec.priority }} | <strong>Category:</strong> {{ rec.category }}</p>
                    <p><strong>Rationale:</strong> {{ rec.rationale }}</p>
                    <p><strong>Expected Impact:</strong> {{ rec.impact }}</p>
                    <p><strong>Estimated Savings:</strong> {{ rec.estimated_savings }}</p>
                </div>
                {% endfor %}
            </div>
            {% endif %}
            
            <!-- Trend Analysis -->
            {% if ai_insights.trend_analysis %}
            <div class="section">
                <h2>üìà Trend Analysis</h2>
                <p><strong>Trend Direction:</strong> 
                    <span class="status-badge {% if ai_insights.trend_analysis.trend_status == 'positive' %}status-strong{% elif ai_insights.trend_analysis.trend_status == 'warning' %}status-needs-work{% else %}status-good{% endif %}">
                        {{ ai_insights.trend_analysis.trend_direction | capitalize }} ({{ "%.1f" | format(ai_insights.trend_analysis.trend_percentage) }}%)
                    </span>
                </p>
                
                <h3>Monthly Ticket Volume</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Period</th>
                            <th>Tickets</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for month in ai_insights.trend_analysis.monthly_volumes %}
                        <tr>
                            <td>{{ month.month }}</td>
                            <td>{{ month.volume }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                
                {% for insight in ai_insights.trend_analysis.insights %}
                <div class="insight-box {% if ai_insights.trend_analysis.trend_status == 'positive' %}positive{% elif ai_insights.trend_analysis.trend_status == 'warning' %}warning{% endif %}">
                    {{ insight }}
                </div>
                {% endfor %}
            </div>
            {% endif %}
            
            <!-- Anomalies -->
            {% if ai_insights.anomalies %}
            <div class="section">
                <h2>‚ö†Ô∏è Detected Anomalies</h2>
                {% for anomaly in ai_insights.anomalies %}
                <div class="gap-card {% if anomaly.severity == 'High' %}high{% else %}medium{% endif %}">
                    <span class="severity-badge severity-{{ anomaly.severity | lower }}">{{ anomaly.severity }}</span>
                    <h3>{{ anomaly.type }}</h3>
                    <p><strong>Description:</strong> {{ anomaly.description }}</p>
                    <p><strong>Recommendation:</strong> {{ anomaly.recommendation }}</p>
                </div>
                {% endfor %}
            </div>
            {% endif %}
            
            <!-- NIST Scores -->
            <div class="section">
                <h2>NIST Cybersecurity Framework Scores</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Category</th>
                            <th>Score</th>
                            <th>Status</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Identify</strong></td>
                            <td>{{ "%.1f" | format(nist_scores.Identify * 100) }}%</td>
                            <td>
                                {% if nist_scores.Identify >= 0.9 %}
                                <span class="status-badge status-strong">‚úì Strong</span>
                                {% elif nist_scores.Identify >= 0.75 %}
                                <span class="status-badge status-good">‚Üí Good</span>
                                {% else %}
                                <span class="status-badge status-needs-work">‚ö† Needs Work</span>
                                {% endif %}
                            </td>
                            <td>Asset visibility and inventory management</td>
                        </tr>
                        <tr>
                            <td><strong>Protect</strong></td>
                            <td>{{ "%.1f" | format(nist_scores.Protect * 100) }}%</td>
                            <td>
                                {% if nist_scores.Protect >= 0.9 %}
                                <span class="status-badge status-strong">‚úì Strong</span>
                                {% elif nist_scores.Protect >= 0.75 %}
                                <span class="status-badge status-good">‚Üí Good</span>
                                {% else %}
                                <span class="status-badge status-needs-work">‚ö† Needs Work</span>
                                {% endif %}
                            </td>
                            <td>Preventive security controls</td>
                        </tr>
                        <tr>
                            <td><strong>Detect</strong></td>
                            <td>{{ "%.1f" | format(nist_scores.Detect * 100) }}%</td>
                            <td>
                                {% if nist_scores.Detect >= 0.9 %}
                                <span class="status-badge status-strong">‚úì Strong</span>
                                {% elif nist_scores.Detect >= 0.75 %}
                                <span class="status-badge status-good">‚Üí Good</span>
                                {% else %}
                                <span class="status-badge status-needs-work">‚ö† Needs Work</span>
                                {% endif %}
                            </td>
                            <td>Threat detection and monitoring</td>
                        </tr>
                        <tr>
                            <td><strong>Respond</strong></td>
                            <td>{{ "%.1f" | format(nist_scores.Respond * 100) }}%</td>
                            <td>
                                {% if nist_scores.Respond >= 0.9 %}
                                <span class="status-badge status-strong">‚úì Strong</span>
                                {% elif nist_scores.Respond >= 0.75 %}
                                <span class="status-badge status-good">‚Üí Good</span>
                                {% else %}
                                <span class="status-badge status-needs-work">‚ö† Needs Work</span>
                                {% endif %}
                            </td>
                            <td>Incident response and SLA performance</td>
                        </tr>
                        <tr>
                            <td><strong>Recover</strong></td>
                            <td>{{ "%.1f" | format(nist_scores.Recover * 100) }}%</td>
                            <td>
                                {% if nist_scores.Recover >= 0.9 %}
                                <span class="status-badge status-strong">‚úì Strong</span>
                                {% elif nist_scores.Recover >= 0.75 %}
                                <span class="status-badge status-good">‚Üí Good</span>
                                {% else %}
                                <span class="status-badge status-needs-work">‚ö† Needs Work</span>
                                {% endif %}
                            </td>
                            <td>Business continuity and backup</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <!-- Key Metrics -->
            <div class="section">
                <h2>Key Operational Metrics</h2>
                
                <div class="metric-grid">
                    <div class="metric-box">
                        <div class="label">Total Assets</div>
                        <div class="value">{{ signals.total_assets }}</div>
                    </div>
                    <div class="metric-box">
                        <div class="label">Active Users</div>
                        <div class="value">{{ signals.total_users }}</div>
                    </div>
                    <div class="metric-box">
                        <div class="label">Servers</div>
                        <div class="value">{{ signals.server_count }}</div>
                    </div>
                    <div class="metric-box">
                        <div class="label">Endpoints</div>
                        <div class="value">{{ signals.endpoint_count }}</div>
                    </div>
                </div>
                
                <table>
                    <thead>
                        <tr>
                            <th>Metric</th>
                            <th>Current Value</th>
                            <th>Target</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Patch Compliance</td>
                            <td>{{ "%.1f" | format(signals.patch_compliance) }}%</td>
                            <td>‚â• 95%</td>
                            <td>
                                {% if signals.patch_compliance >= 95 %}
                                <span class="status-badge status-strong">‚úì On Target</span>
                                {% else %}
                                <span class="status-badge status-needs-work">‚ö† Below Target</span>
                                {% endif %}
                            </td>
                        </tr>
                        <tr>
                            <td>Backup Coverage</td>
                            <td>{{ "%.1f" | format(signals.backup_status) }}%</td>
                            <td>‚â• 98%</td>
                            <td>
                                {% if signals.backup_status >= 98 %}
                                <span class="status-badge status-strong">‚úì On Target</span>
                                {% else %}
                                <span class="status-badge status-needs-work">‚ö† Below Target</span>
                                {% endif %}
                            </td>
                        </tr>
                        <tr>
                            <td>EDR Coverage</td>
                            <td>{{ "%.1f" | format(signals.edr) }}%</td>
                            <td>‚â• 90%</td>
                            <td>
                                {% if signals.edr >= 90 %}
                                <span class="status-badge status-strong">‚úì On Target</span>
                                {% else %}
                                <span class="status-badge status-needs-work">‚ö† Below Target</span>
                                {% endif %}
                            </td>
                        </tr>
                        <tr>
                            <td>SLA Attainment</td>
                            <td>{{ "%.1f" | format(signals.response_time_sla) }}%</td>
                            <td>‚â• 90%</td>
                            <td>
                                {% if signals.response_time_sla >= 90 %}
                                <span class="status-badge status-strong">‚úì On Target</span>
                                {% else %}
                                <span class="status-badge status-needs-work">‚ö† Below Target</span>
                                {% endif %}
                            </td>
                        </tr>
                        <tr>
                            <td>MFA Enforcement</td>
                            <td>{% if signals.mfa_enforced %}Enabled{% else %}Not Enabled{% endif %}</td>
                            <td>Enabled</td>
                            <td>
                                {% if signals.mfa_enforced %}
                                <span class="status-badge status-strong">‚úì Enabled</span>
                                {% else %}
                                <span class="status-badge status-needs-work">‚ö† Not Enabled</span>
                                {% endif %}
                            </td>
                        </tr>
                        <tr>
                            <td>Avg. Monthly Incidents</td>
                            <td>{{ signals.avg_monthly_incidents }}</td>
                            <td>-</td>
                            <td>-</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <!-- Gaps -->
            <div class="section">
                <h2>Identified Gaps and Risks</h2>
                {% if gaps %}
                    {% for gap in gaps %}
                    <div class="gap-card {% if gap.severity == 'High' %}high{% elif gap.severity == 'Medium' %}medium{% endif %}">
                        <span class="severity-badge severity-{{ gap.severity | lower }}">{{ gap.severity }}</span>
                        <h3>{{ gap.gap }}</h3>
                        <p><strong>Category:</strong> {{ gap.category }}</p>
                        <p><strong>Current Value:</strong> {{ gap.current_value }} | <strong>Threshold:</strong> {{ gap.threshold }}</p>
                        <p><strong>Impact:</strong> {{ gap.impact }}</p>
                    </div>
                    {% endfor %}
                {% else %}
                    <p style="color: #10b981; font-weight: bold;">‚úì No critical gaps identified. Current security posture meets or exceeds all thresholds.</p>
                {% endif %}
            </div>
            
            <!-- Standard Recommendations -->
            <div class="section">
                <h2>Recommendations</h2>
                {% if recommendations %}
                    {% for rec in recommendations %}
                    <div class="rec-card">
                        <h3>{{ loop.index }}. {{ rec.recommendation }}</h3>
                        <p><strong>Priority:</strong> {{ rec.priority }} | <strong>NIST Category:</strong> {{ rec.category }}</p>
                        <p><strong>Action Items:</strong></p>
                        <ul>
                            {% for action in rec.action_items %}
                            <li>{{ action }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                    {% endfor %}
                {% else %}
                    <p style="color: #10b981; font-weight: bold;">‚úì No immediate recommendations. Continue monitoring and maintaining current security posture.</p>
                {% endif %}
            </div>
            
            <!-- Budget -->
            <div class="section">
                <h2>Budget Projection</h2>
                {% if budget.services %}
                    <p>The following monthly budget estimates address the identified gaps:</p>
                    <table>
                        <thead>
                            <tr>
                                <th>Service</th>
                                <th>Quantity</th>
                                <th>Unit Cost</th>
                                <th>Monthly Cost</th>
                                <th>Annual Cost</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for service in budget.services %}
                            <tr>
                                <td>{{ service.service }}</td>
                                <td>{{ service.quantity }} {{ service.unit }}</td>
                                <td>${{ "%.2f" | format(service.unit_cost) }}</td>
                                <td>${{ "%.2f" | format(service.monthly_cost) }}</td>
                                <td>${{ "%.2f" | format(service.annual_cost) }}</td>
                            </tr>
                            {% endfor %}
                            <tr style="background: #f0f9ff; font-weight: bold;">
                                <td colspan="3">TOTAL</td>
                                <td>${{ "%.2f" | format(budget.total_monthly) }}</td>
                                <td>${{ "%.2f" | format(budget.total_annual) }}</td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <div class="budget-summary">
                        <h3>Investment Justification</h3>
                        <p>Implementing these recommendations will:</p>
                        <ul>
                            <li>Reduce security risk exposure by addressing critical gaps</li>
                            <li>Improve operational efficiency and incident response times</li>
                            <li>Ensure compliance with industry best practices and frameworks</li>
                            <li>Provide measurable ROI through reduced breach risk and downtime</li>
                        </ul>
                        <div class="budget-total">
                            Total Investment: ${{ "%.2f" | format(budget.total_monthly) }}/month
                        </div>
                    </div>
                {% else %}
                    <p style="color: #10b981; font-weight: bold;">‚úì No additional budget required at this time. Current investments are adequate for the identified posture.</p>
                {% endif %}
            </div>
            
            <!-- Next Steps -->
            <div class="section">
                <h2>Next Steps</h2>
                <ol>
                    <li><strong>Review and Validate:</strong> Confirm accuracy of data and identified gaps with technical team</li>
                    <li><strong>Prioritize Actions:</strong> Align recommendations with business objectives and budget cycles</li>
                    <li><strong>Create Implementation Plan:</strong> Develop timeline and resource allocation for priority items</li>
                    <li><strong>Schedule Follow-up:</strong> Plan quarterly review to measure progress and adjust strategy</li>
                    <li><strong>Customer Communication:</strong> Present findings and recommendations in executive briefing</li>
                </ol>
            </div>
        </div>
        
        <div class="footer">
            <p><strong>Report prepared by Computer Integration Technologies</strong></p>
            <p>Automated Strategic Business Review Generator with AI Insights</p>
            <p style="margin-top: 10px; font-size: 0.9em;">Data extracted from HaloPSA | NIST CSF v1.1 Methodology | AI-Powered Analysis</p>
        </div>
    </div>
</body>
</html>

